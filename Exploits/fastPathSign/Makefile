TARGET = fastPathSign

CC = clang

CFLAGS = -framework Foundation -framework CoreServices -framework Security -fobjc-arc \
         $(shell pkg-config --cflags libcrypto) \
         -I../../ChOma/src \
         -I../../Shared

LDFLAGS = $(shell pkg-config --libs libcrypto)

SRCS = src/codesign.m src/main.m src/coretrust_bug.c \
       ../../ChOma/src/*.c \
       ../../Shared/*.c

OBJS = $(SRCS:.c=.o)
OBJS := $(OBJS:.m=.o)  # на случай, если .m не заменился

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

%.o: %.m
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f $(OBJS) $(TARGET)
